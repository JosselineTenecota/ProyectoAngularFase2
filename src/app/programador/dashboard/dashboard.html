<div class="dash-wrapper wrapper">
  
  <div class="dash-header">
    <h1>Mi Portafolio</h1>
    <p>Bienvenido, gestiona tus proyectos acad茅micos y laborales.</p>
  </div>

  <div class="dash-grid">
    
    <!-- === COLUMNA 1: Formulario de Creaci贸n === -->
    <div class="form-card">
      <h2>Nuevo Proyecto</h2>
      
      <!-- TTULO (Obligatorio) -->
      <div class="form-group">
        <label>T铆tulo del Proyecto</label>
        <input type="text" 
               [(ngModel)]="newProject.titulo" 
               name="titulo"
               required 
               #titulo="ngModel"
               placeholder="Ej: Sistema de Ventas" 
               class="input-dark">
        
        <!-- Mensaje de Error -->
        <span *ngIf="titulo.invalid && (titulo.dirty || titulo.touched)" class="error-msg">
          * El t铆tulo es obligatorio.
        </span>
      </div>

      <!-- TIPO PROYECTO (Obligatorio) -->
      <div class="form-group">
        <label>Tipo de Proyecto</label>
        <select [(ngModel)]="newProject.tipo" class="input-dark">
          <option value="Academico">Acad茅mico</option>
          <option value="Laboral">Laboral</option>
        </select>
      </div>

      <!-- TIPO PARTICIPACIN (Obligatorio) -->
      <div class="form-group">
        <label>Tipo de Participaci贸n</label>
        <select [(ngModel)]="newProject.participacion" class="input-dark">
          <option value="Frontend">Frontend</option>
          <option value="Backend">Backend</option>
          <option value="Base de Datos">Base de Datos</option>
        </select>
      </div>

      <!-- TECNOLOGAS (Obligatorio) -->
      <div class="form-group">
        <label>Tecnolog铆as (separadas por coma)</label>
        <input type="text" 
               [(ngModel)]="newProject.tecnologias"
               name="tecnologias"
               required
               #tec="ngModel" 
               placeholder="Angular, Firebase, Sass..." 
               class="input-dark">
        
        <span *ngIf="tec.invalid && (tec.dirty || tec.touched)" class="error-msg">
          * Indica las tecnolog铆as usadas.
        </span>
      </div>

      <!-- DESCRIPCIN (Obligatorio) -->
      <div class="form-group">
        <label>Descripci贸n</label>
        <textarea [(ngModel)]="newProject.descripcion" 
                  name="descripcion"
                  rows="4" 
                  required
                  #desc="ngModel"
                  class="input-dark"></textarea>
        
        <span *ngIf="desc.invalid && (desc.dirty || desc.touched)" class="error-msg">
          * La descripci贸n es obligatoria.
        </span>
      </div>

      <!-- URLS (Opcionales) -->
      <div class="form-row">
        <div class="form-group">
          <label>URL Repositorio (Git)</label>
          <input type="text" [(ngModel)]="newProject.repoUrl" class="input-dark">
        </div>
        <div class="form-group">
          <label>URL Demo (Deploy)</label>
          <input type="text" [(ngModel)]="newProject.demoUrl" class="input-dark">
        </div>
      </div>

      <!-- BOTN (Se deshabilita si faltan datos) -->
      <button class="btn-submit" 
              (click)="addProject()"
              [disabled]="!newProject.titulo || !newProject.descripcion || !newProject.tecnologias"
              [style.opacity]="(!newProject.titulo || !newProject.descripcion || !newProject.tecnologias) ? '0.5' : '1'">
        Publicar Proyecto
      </button>
    </div>

    <!-- === COLUMNA 2: Lista de mis proyectos === -->
    <div class="projects-list">
      <h2>Mis Proyectos Publicados</h2>

      <div class="project-card" *ngFor="let p of projects$ | async">
        <div class="card-header">
          <div>
            <!-- Badge 1: Acad茅mico/Laboral -->
            <span class="badge" [class.work]="p.tipo === 'Laboral'">{{ p.tipo }}</span>
            
            <!-- Badge 2: Participaci贸n -->
            <span style="font-size: 0.8rem; color: #aaa; margin-left: 8px; font-weight: 600; text-transform: uppercase; border: 1px solid #444; padding: 2px 6px; border-radius: 4px;">
               {{ p.participacion }}
            </span>
          </div>

          <button class="btn-delete" (click)="deleteProject(p.id!)"></button>
        </div>
        
        <h3>{{ p.titulo }}</h3>
        <p class="tech">{{ p.tecnologias }}</p>
        <p class="desc">{{ p.descripcion }}</p>
        
        <div class="links">
          <a *ngIf="p.repoUrl" [href]="p.repoUrl" target="_blank">Ver C贸digo</a>
          <a *ngIf="p.demoUrl" [href]="p.demoUrl" target="_blank">Ver Demo</a>
        </div>
      </div>

      <!-- Mensaje si no hay proyectos -->
      <div *ngIf="(projects$ | async)?.length === 0" class="empty-state">
        <p>A煤n no has subido proyectos.</p>
      </div>
    </div>

  </div>

  <!-- SECCIN DE ASESORAS (PROGRAMADOR) -->
  <div class="appointments-section">
    <h2>Solicitudes de Asesor铆a Recibidas</h2>
    
    <div class="appointments-grid">
      <div class="appt-card" *ngFor="let cita of asesorias$ | async" [ngClass]="cita.estado.toLowerCase()">
        
        <div class="appt-header">
          <!-- Badge de Estado -->
          <span class="status-badge" [ngClass]="cita.estado.toLowerCase()">{{ cita.estado }}</span>
          <!-- Fecha -->
          <span class="date"> {{ cita.fecha }} |  {{ cita.hora }}</span>
        </div>

        <div class="appt-body">
          <h3> {{ cita.clienteNombre }}</h3>
          <span class="email-client">锔 {{ cita.clienteEmail }}</span>
          
          <div class="topic-box">
            <strong>Tema:</strong> {{ cita.tema }}
          </div>

          <!-- Muestra tu respuesta si ya respondiste -->
          <div class="answer-box" *ngIf="cita.respuesta">
            <strong>Tu respuesta:</strong> {{ cita.respuesta }}
          </div>

          <!-- BOTONES (Solo visibles si est谩 PENDIENTE) -->
          <div class="actions" *ngIf="cita.estado === 'Pendiente'">
            <button class="btn-action approve" (click)="responderAsesoria(cita, 'Aprobada')">Aprobar</button>
            <button class="btn-action reject" (click)="responderAsesoria(cita, 'Rechazada')">Rechazar</button>
          </div>
        </div>

      </div>

      <!-- Mensaje vacio -->
      <div *ngIf="(asesorias$ | async)?.length === 0" class="empty-state-appt">
        No tienes solicitudes pendientes.
      </div>
    </div>
  </div>

</div>